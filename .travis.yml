branches:
  only:
    - master
language: go
install:
- go get -v github.com/spf13/hugo
- sudo pip install s3cmd
- sudo pip install awscli
script:
- hugo
- s3cmd --acl-public --delete-removed --add-header=Cache-Control:max-age=3600,s-max-age=86400 --no-progress sync public/ s3://blog.vvatanabe.com
- aws configure set preview.cloudfront true
- aws cloudfront create-invalidation --distribution-id ${DISTRIBUTION_ID} --paths '/*'
notifications:
  email:
    recipients: yuichi.watanabe.ja@gmail.com
    on_failure: always